"use strict";var cookie=getCookie("name");function init(){$.ajax({type:"post",url:"../api/carts.php",async:!1,data:{user:cookie},success:function(t){var s=JSON.parse(t).map(function(t){return'\n\t\t\t\t<ul class="order_lists" data-id="'.concat(t.id,'">\n\t\t\t\t\t\t<li class="list_chk">\n\t\t\t\t\t\t\t<input type="checkbox" id="checkbox_').concat(t.id,'" class="son_check">\n\t\t\t\t\t\t\t<label for="checkbox_').concat(t.id,'"></label>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li class="list_con">\n\t\t\t\t\t\t\t<div class="list_img">\n\t\t\t\t\t\t\t\t<a href="javascript:;"><img src="').concat(t.img,'" alt=""></a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="list_text">\n\t\t\t\t\t\t\t\t<a href="javascript:;">').concat(t.title,'</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li class="list_info">\n\t\t\t\t\t\t\t<p>样式：默认</p>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li class="list_price">\n\t\t\t\t\t\t\t<p class="price">￥').concat(t.price,'</p>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li class="list_amount">\n\t\t\t\t\t\t\t<div class="amount_box">\n\t\t\t\t\t\t\t\t<a href="javascript:;" class="reduce reSty">-</a>\n\t\t\t\t\t\t\t\t<input type="text" value="').concat(t.number,'" class="sum">\n\t\t\t\t\t\t\t\t<a href="javascript:;" class="plus">+</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li class="list_sum">\n\t\t\t\t\t\t\t<p class="sum_price">￥').concat(t.price*t.number,'</p>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li class="list_op">\n\t\t\t\t\t\t\t<p class="del">\n\t\t\t\t\t\t\t\t<a href="javascript:;" class="delBtn">移除商品</a>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>')}).join("");$(".order_content").html(s)}})}init(),$(function(){var t=$('input[type="checkbox"]'),e=$(".whole_check"),s=$(".cartBox"),i=$(".shopChoice"),a=$(".son_check");t.click(function(){$(this).is(":checked")?$(this).next("label").addClass("mark"):$(this).next("label").removeClass("mark")}),e.click(function(){var t=s.find('input[type="checkbox"]');$(this).is(":checked")?(t.prop("checked",!0),t.next("label").addClass("mark")):(t.prop("checked",!1),t.next("label").removeClass("mark")),d()}),a.each(function(){$(this).on("click",function(){if($(this).is(":checked")){var t=a.length,s=0;a.each(function(){$(this).is(":checked")&&s++}),s==t&&(e.prop("checked",!0),e.next("label").addClass("mark"))}else e.prop("checked",!1),e.next("label").removeClass("mark")})}),i.each(function(){$(this).click(function(){if($(this).is(":checked")){var t=i.length,s=0;i.each(function(){$(this).is(":checked")&&s++}),s==t&&(e.prop("checked",!0),e.next("label").addClass("mark")),$(this).parents(".cartBox").find(".son_check").prop("checked",!0),$(this).parents(".cartBox").find(".son_check").next("label").addClass("mark")}else e.prop("checked",!1),e.next("label").removeClass("mark"),$(this).parents(".cartBox").find(".son_check").prop("checked",!1),$(this).parents(".cartBox").find(".son_check").next("label").removeClass("mark");d()})}),s.each(function(){var e=$(this).find(".son_check");e.each(function(){$(this).on("click",function(){if($(this).is(":checked")){var t=e.length,s=0;e.each(function(){$(this).is(":checked")&&s++}),s==t&&($(this).parents(".cartBox").find(".shopChoice").prop("checked",!0),$(this).parents(".cartBox").find(".shopChoice").next("label").addClass("mark"))}else $(this).parents(".cartBox").find(".shopChoice").prop("checked",!1),$(this).parents(".cartBox").find(".shopChoice").next("label").removeClass("mark");d()})})});var n=$(".plus"),c=$(".reduce"),l=$(".sum");n.click(function(){var t=$(this).prev("input"),s=parseInt(t.val())+1,e=$(this).parents(".amount_box").find(".reduce"),i=$(this).parents(".order_lists").find(".sum_price"),a=$(this).parents(".order_lists").find(".price").html(),n=s*parseInt(a.substring(1));t.val(s),i.html("￥"+n),1<t.val()&&e.hasClass("reSty")&&e.removeClass("reSty"),d()}),c.click(function(){var t=$(this).next("input"),s=parseInt(t.val())-1,e=$(this).parents(".order_lists").find(".sum_price"),i=$(this).parents(".order_lists").find(".price").html(),a=s*parseInt(i.substring(1));1<t.val()&&(t.val(s),e.html("￥"+a)),1!=t.val()||$(this).hasClass("reSty")||$(this).addClass("reSty"),d()}),l.keyup(function(){var t,s,e=$(this).parents(".order_lists").find(".sum_price"),i=$(this).parents(".order_lists").find(".price").html();""==$(this).val()&&$(this).val("1"),$(this).val($(this).val().replace(/\D|^0/g,"")),s=(t=$(this).val())*parseInt(i.substring(1)),$(this).attr("value",t),e.html("￥"+s),d()});var r=null,o="",h="";function p(){$(".model_bg").fadeOut(300),$(".my_model").fadeOut(300)}function d(){var e=0,i=0,t=$(".calBtn a");a.each(function(){if($(this).is(":checked")){var t=parseInt($(this).parents(".order_lists").find(".sum_price").html().substring(1)),s=parseInt($(this).parents(".order_lists").find(".sum").val());e+=t,i+=s}}),$(".total_text").html("￥"+e),$(".piece_num").html(i),0!=e&&0!=i?t.hasClass("btn_sty")||t.addClass("btn_sty"):t.hasClass("btn_sty")&&t.removeClass("btn_sty")}$(".delBtn").click(function(){h=$(this).parents(".order_lists").data("id"),r=$(this).parents(".order_lists"),o=r.parents(".order_content"),$(".model_bg").fadeIn(300),$(".my_model").fadeIn(300)}),$(".closeModel").click(function(){p()}),$(".dialog-close").click(function(){p()}),$(".dialog-sure").click(function(){r.remove(),null!=o.html().trim()&&0!=o.html().trim().length||o.parents(".cartBox").remove(),p(),a=$(".son_check"),d(),$.ajax({type:"post",url:"../api/carts.php",async:!0,data:{type:"remove",id:h,user:cookie},success:function(t){}})})});var isok=!0,num="";$(".amount_box").on("click","a",function(){num=$(this).parents(".amount_box").find("input").val(),id=$(this).parents(".order_lists").data("id"),isok=!1,setTimeout(function(){$.ajax({type:"post",url:"../api/carts.php",async:!0,data:{type:"update",id:id,user:cookie,num:num},success:function(t){}}),isok=!0},1500)}),$(".sum").keyup(function(){id=$(this).parents(".order_lists").data("id"),setTimeout(function(){$.ajax({type:"post",url:"../api/carts.php",async:!0,data:{type:"update",id:id,user:cookie,num:$(".sum").val()},success:function(t){}}),isok=!0},1e3)}),$(".signOut").click(function(){window.location.href="../index.html"});